--
--
-- This program is the confidential and proprietary product of 
-- Fast Track Systems, Inc.  Any unauthorized use, reproduction, 
-- or transfer of this program is strictly prohibited.  
-- Copyright (C) 2000 by Fast Track Systems, Inc.  
-- All rights reserved.
-- 
-- $Workfile: c:\tsm\Database\DJMaps\inc_load\currency_inc.sql$ 
--
-- $Revision: 19$        $Date: 4/15/2011 3:48:20 PM$
--
--
-- Description:  <ADD>
--
---------------------------------------------------------------------
-- can be directly inserted into tsm10 from build_code1
-- No initial step required


declare

   cursor c1 is select abbreviation from tsm_stage.country2 where
   abbreviation not in ('ARI','BEL','FIN','FRA','DEU','IRL','ITA','NET','ESP',
		    'BUL','FSU','PHC','SCY','SCA','GCE','POR','LUX',
		     'EEU','EUR','SLO','MON','EU','SC','WEU',
                     'PRT','IPK','ALB','AND','BAL','CUB','DOM','EEC',
                     'GEO','ISB','MAC','OAF','ECE','OFE','MDE','RSM',
		     'NEP','NA','LA','PA','MA','USA');
   currencyid number(10);
   currency_maxid number(10);

begin

   select nvl(max(id),0)+1 into currency_maxid from "&1".currency;

   for ix1 in c1 loop

  	select currency_id into currencyid from "&1".country
        where abbreviation = ix1.abbreviation;

        --Commented as per discussion with DB on 01/10/2011
        /* if currencyid is null then  
	  Insert into "&1".currency(id,name,symbol,cnv_rate,VIEWABLE_FLG) select
          currency_maxid,cnv_name,cnv_symbol,cnv_rate,0 from tsm_stage.country2
          where abbreviation = ix1.abbreviation;

          update "&1".country set currency_id = currency_maxid
          where abbreviation = ix1.abbreviation;

          currency_maxid:=currency_maxid+1;
        else
	  update "&1".currency set (name,symbol,cnv_rate)=(select
          cnv_name,cnv_symbol,cnv_rate from tsm_stage.country2 
	  where abbreviation = ix1.abbreviation) where id = currencyid;
	end if;
       */

       if currencyid is not null then
		update "&1".currency set cnv_rate=(select
          	cnv_rate from tsm_stage.country2 
	  	where abbreviation = ix1.abbreviation) where id = currencyid;
	end if;

   end loop;

            
   select currency_id into currencyid from "&1".country where abbreviation = 'EUR';

   update "&1".currency set cnv_rate = (select cnv_rate from tsm_stage.country2
   where abbreviation='EUR') where id=currencyid;
 

   update "&1".country set currency_id = currencyid where
   abbreviation in ('ARI','BEL','FIN','FRA','DEU','IRL','ITA','NET','ESP','GCE','POR','LUX',
 		'EEU','SLO','MON','EU','SC','WEU'); 

   select currency_id into currencyid from "&1".country where abbreviation = 'USA';

   update "&1".country set currency_id = currencyid where
   abbreviation in ('BUL','FSU','PHC','SCY','SCA','PRT','IPK','ALB','AND','BAL','CUB','DOM','EEC',
                     'GEO','ISB','MAC','OAF','ECE','OFE','MDE','RSM',
		     'NEP','NA','LA','PA','MA');

   update "&1".currency set (name,symbol,cnv_rate)=(select
   'US Dollar','$',1 from dual) where id = currencyid;

   /* update "&1".country set currency_id = currencyid where
   abbreviation in (select abbreviation from tsm_stage.country2
   where lower(cnv_name)='us dollar' and cnv_rate=1 and cnv_symbol='$');*/

   Delete from "&1".currency where id not in (select currency_id from "&1".country
   where currency_id is not null) and id <>0  and lower(name) = 'us dollar' and
   symbol='$' and cnv_rate=1;

  commit;

end;
/
sho err



-- Following lines are added by Debashish on 01/20/2003 to add more country references to currency table

--declare

--   cursor c1 is select abbreviation,cnv_rate from tsm_stage.country2 where cnv_rate is not null;
--   invalid_cntry exception;
--   country_exist number(5);
--   currencyid number(10);
--   currency_maxid number(10);
--   usacurrencyid number(10);
--  eurocurrencyid number(10);

--begin

--   select nvl(max(id),0)+1 into currency_maxid from "&1".currency;
--   select currency_id into usacurrencyid from "&1".country where abbreviation = 'USA';
--   select currency_id into eurocurrencyid from "&1".country where abbreviation = 'EUR';

--   for ix1 in c1 loop

--        select count(*) into country_exist from "&1".country
--	where abbreviation = ix1.abbreviation;

--        if country_exist = 0 then 
--          raise invalid_cntry;
--        end if; 

--        if ix1.cnv_rate = 1 then 
--          update "&1".country set currency_id = usacurrencyid where abbreviation = ix1.abbreviation ;
 
--        else

--  	  select currency_id into currencyid from "&1".country
--          where abbreviation = ix1.abbreviation; 

--         if currencyid is null then  
--	    Insert into "&1".currency(id,cnv_rate) values (currency_maxid,ix1.cnv_rate) ;

--            update "&1".country set currency_id = currency_maxid
--            where abbreviation = ix1.abbreviation;

--            currency_maxid:=currency_maxid+1;
--          else
--	    update "&1".currency set cnv_rate=ix1.cnv_rate where id = currencyid 
--            and id not in (usacurrencyid,eurocurrencyid) ;
--	  end if;
--        end if;
--   end loop;



--exception

--   when invalid_cntry then
--	raise_application_error(-20202,'Country exists in country2, but not in country table');
--end;
--/
--sho err

--commit;

-- End of the code changes don on 01/20/2003


--update "&1".currency set name='Australian dollar' where id = 
--	(select currency_id from "&1".country where abbreviation='AUS');
 
--update "&1".currency set name='Canadian dollar' where id = 
--	(select currency_id from "&1".country where abbreviation='CAN');

--update "&1".currency set name='Danish krone' where id = 
--	(select currency_id from "&1".country where abbreviation='DEN');

--update "&1".currency set name='Forint' where id = 
--	(select currency_id from "&1".country where abbreviation='HUN');

--update "&1".currency set name='Israeli shekel' where id = 
--	(select currency_id from "&1".country where abbreviation='ISR');

--update "&1".currency set name='Norwegian krone' where id = 
--	(select currency_id from "&1".country where abbreviation='NOR');

--update "&1".currency set name='Zloty' where id = 
--	(select currency_id from "&1".country where abbreviation='POL');

--update "&1".currency set name='Rand' where id = 
--	(select currency_id from "&1".country where abbreviation='SAF');

--update "&1".currency set name='Swedish krona' where id = 
--	(select currency_id from "&1".country where abbreviation='SWE');

--update "&1".currency set name='Swiss franc' where id = 
--	(select currency_id from "&1".country where abbreviation='SWI');

--update "&1".currency set name='British pound' where id = 
--	(select currency_id from "&1".country where abbreviation='UK');

--update "&1".currency set name='US-Dollar' where id = 
--	(select currency_id from "&1".country where abbreviation='USA');

--update "&1".currency set name='EURO' where id = 
--	(select currency_id from "&1".country where abbreviation='EUR');

--commit;

update "&1".currency set symbol = '£' where lower(name) = 'british pound';
update "&1".currency set symbol = '€' where lower(name) = 'euro';


commit;


declare

  currency_nextid number(10);

 begin

  select nvl(max(id),0)+1 into currency_nextid from "&1".currency;
  update "&1".id_control set next_id = currency_nextid where
  upper(table_name) = 'CURRENCY';
end;
/
sho err
commit;

-- Following chnages are as per the request of Kelly on 04-26-2004

--update "&1".currency a set (a.name,a.symbol)= (select 'Lev','Lw' from dual)
--  where id in (select currency_id from "&1".country where abbreviation='BLG');
--update "&1".currency a set (a.name,a.symbol)= (select 'Lei','L' from dual)
--  where id in (select currency_id from "&1".country where abbreviation='RUM');
--update "&1".currency a set (a.name,a.symbol)= (select 'Koruny','Kc' from dual)
--  where id in (select currency_id from "&1".country where abbreviation='CZE');
--update "&1".currency a set (a.name,a.symbol)= (select 'Koruny','Sk' from dual)
--  where id in (select currency_id from "&1".country where abbreviation='SVK');
--update "&1".currency a set (a.name,a.symbol)= (select 'Rouble','Rb' from dual)
--  where id in (select currency_id from "&1".country where abbreviation='RIA');
--update "&1".currency a set (a.name,a.symbol)= (select 'Krooni','KR' from dual)
--  where id in (select currency_id from "&1".country where abbreviation='EST');
--update "&1".currency a set (a.name,a.symbol)= (select 'Lati','Ls' from dual)
--  where id in (select currency_id from "&1".country where abbreviation='LAT');
--update "&1".currency a set (a.name,a.symbol)= (select 'Litai','L' from dual)
--  where id in (select currency_id from "&1".country where abbreviation='LIT');
--update "&1".currency a set (a.name,a.symbol)= (select 'Dinar','Din' from dual)
-- where id in (select currency_id from "&1".country where abbreviation='YUG');
--update "&1".currency a set (a.name,a.symbol)= (select 'Tolars','SIT' from dual)
--  where id in (select currency_id from "&1".country where abbreviation='SLO');
--update "&1".currency a set (a.name,a.symbol)= (select 'Kuna','HRK' from dual)
--  where id in (select currency_id from "&1".country where abbreviation='CRO');
--commit;

-- Following statement need only be executed after 2004Q3 import
-- It may please be removed from this script after that.

--update "&1".currency set viewable_flg=1 where id = (select currency_id
--from "&1".country where abbreviation='YUG') and id <> (select currency_id
--from "&1".country where abbreviation='USA');
--commit;




---------------------------------------------------------------------
-- MODIFICATION HISTORY:
--
-- $Log: 
--  19   DevTSM    1.18        4/15/2011 3:48:20 PM Mahesh Pasupuleti Include
--       latest changes
--  18   DevTSM    1.17        2/27/2008 3:17:06 PM Debashish Mishra  
--  17   DevTSM    1.16        11/8/2007 10:21:12 PMDebashish Mishra  
--  16   DevTSM    1.15        2/7/2007 10:27:59 PM Debashish Mishra  
--  15   DevTSM    1.14        11/4/2005 9:46:30 AM Debashish Mishra  
--  14   DevTSM    1.13        10/26/2005 3:44:12 PMDebashish Mishra  
--  13   DevTSM    1.12        9/29/2005 11:18:54 AMDebashish Mishra  
--  12   DevTSM    1.11        3/18/2005 8:48:35 AM Debashish Mishra  
--  11   DevTSM    1.10        3/3/2005 6:40:22 AM  Debashish Mishra  
--  10   DevTSM    1.9         10/13/2004 8:01:54 AMDebashish Mishra  
--  9    DevTSM    1.8         10/9/2004 9:21:37 AM Debashish Mishra Modified for
--       new cntrylst.dbf 
--  8    DevTSM    1.7         10/9/2004 8:35:02 AM Debashish Mishra  
--  7    DevTSM    1.6         6/10/2004 12:44:41 PMDebashish Mishra  
--  6    DevTSM    1.5         5/6/2004 8:15:06 PM  Debashish Mishra  
--  5    DevTSM    1.4         8/29/2003 5:13:11 PM Debashish Mishra  
--  4    DevTSM    1.3         1/20/2003 3:35:14 PM Debashish Mishra Modified for
--       additional currencies for the bugs found by Kelly
--  3    DevTSM    1.2         8/30/2002 12:43:06 PMDebashish Mishra Modified for
--       passing the schema name as an parameter
--  2    DevTSM    1.1         3/28/2002 12:03:35 PMDebashish Mishra  
--  1    DevTSM    1.0         3/20/2002 9:24:06 PM Debashish Mishra 
-- $
-- 
---------------------------------------------------------------------

