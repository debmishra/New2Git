

declare

SourceClientDiv varchar2(20) := 'PSW_PROD_25';
DestClientDiv Varchar2(20) := 'PSW_TEST_25';

SourceClientDivId number(10);
DestClientDivId number(10);

DestClientId number(10);
DestUserId number(10);

Cursor C1 is select id,name from ftuser where client_div_id=SourceClientDivId;

begin


Select id into SourceClientDivId from client_div where client_div_identifier=SourceClientDiv;
Select id into DestClientDivId from client_div where client_div_identifier=DestClientDiv;

Select client_id into DestClientId from client_div where client_div_identifier=DestClientDiv;

for ix1 in C1 loop

  select increment_sequence('ftuser_seq') into DestUserId from dual;

--dbms_output.put_line(substr(ix1.name,1,instr(ix1.name,'@'))||DestClientDIv);

  Insert into ftuser select DestUserId, substr(name,1,instr(name,'@'))||DestClientDIv,                            
  PASSWORD,SITE_ID,STARTING_SCREEN,LAST_PASSWORD_UPDATE,FIRST_NAME,LAST_NAME,
  LAST_LOGIN_DATE,PRIMARY_TA_ID,ADDRESS_LINE_1,ADDRESS_LINE_2,CITY,STATE,
  POSTAL_CODE,COUNTRY,WORK_PHONE,HOME_PHONE,FAX,MOBILE_PHONE,EMAIL,PREFERRED_CONTACT,
  TITLE,DestClientId, DestClientDivId,DISPLAY_NAME,ACTIVE_TRACE_USER,ACTIVE_TSM_USER,
  CAN_MODEL_FLAG,DEF_PLAN_CURRENCY_ID,OLD_PASSWORD,ACTIVE_TSPD_USER,LOCKED,
  0,INPUT_PREF,sysdate,MESSAGING_OPT,MESSAGING_FLG,ALT_PLAN_CURRENCY_ID,
  ACTIVE_CROCAS_USER,DEF_CRO_ODC_SAVE_FLG,DEF_CRO_TYPE                   
  from ftuser where id=ix1.id;

    declare

       cursor c2 is select ftgroup_id from ftuser_to_ftgroup where ftuser_id=ix1.id;

    begin

       for ix2 in C2 loop

         Insert into ftuser_to_ftgroup select increment_sequence('ftuser_to_ftgroup_seq'),
         DestUserId,ix2.ftgroup_id from dual;
       end loop;
    end;
end loop;
end;
/